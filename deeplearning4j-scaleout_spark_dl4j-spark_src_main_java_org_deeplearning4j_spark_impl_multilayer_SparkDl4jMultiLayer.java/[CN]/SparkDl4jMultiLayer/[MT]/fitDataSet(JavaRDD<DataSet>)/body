{
  int batchSize=conf.getConf(0).getBatchSize();
  JavaRDD<DataSet> miniBatches=new RDDMiniBatches(batchSize,rdd).miniBatchesJava();
  MultiLayerNetwork network=new MultiLayerNetwork(conf);
  network.init();
  final INDArray params=network.params();
  this.params=sc.broadcast(params);
  accum=sc.accumulator(params,"params",new ParamAccumulator());
  int paramsLength=network.numParams();
  if (params.length() != paramsLength)   throw new IllegalStateException("Number of params " + paramsLength + " was not equal to "+ params.length());
  miniBatches.foreach(new DataSetTrain(accum,this.params,conf.toJson()));
  INDArray newParams=accum.value().divi(miniBatches.count());
  network.setParameters(newParams);
  this.network=network;
  return network;
}
