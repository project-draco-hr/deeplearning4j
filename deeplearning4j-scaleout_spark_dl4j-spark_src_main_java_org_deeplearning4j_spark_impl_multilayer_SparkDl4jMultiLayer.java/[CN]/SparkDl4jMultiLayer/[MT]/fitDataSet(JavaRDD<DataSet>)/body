{
  int iterations=conf.getConf(0).getNumIterations();
  log.info("Running distributed training:  (averaging each iteration = " + averageEachIteration + "), (iterations = "+ iterations+ "), (num partitions = "+ rdd.partitions().size()+ ")");
  if (!averageEachIteration) {
    runIteration(rdd);
  }
 else {
    for (    NeuralNetConfiguration conf : this.conf.getConfs()) {
      conf.setNumIterations(1);
    }
    for (int i=0; i < iterations; i++) {
      runIteration(rdd);
    }
    if (iterations > 1) {
      for (      NeuralNetConfiguration conf : this.conf.getConfs()) {
        conf.setNumIterations(iterations);
      }
    }
  }
  return network;
}
