{
  if (layerWiseConfigurations == null || layers == null) {
    intializeConfigurations();
  }
  INDArray layerInput=input;
  int inputSize;
  if (getnLayers() < 1)   throw new IllegalStateException("Unable to createComplex network neuralNets; number specified is less than 1");
  int[] hiddenLayerSizes=layerWiseConfigurations.getHiddenLayerSizes();
  if (this.neuralNets == null || neuralNets == null || this.neuralNets[0] == null || this.neuralNets[0] == null) {
    this.neuralNets=new NeuralNetwork[getnLayers()];
    for (int i=0; i < this.getnLayers(); i++) {
      if (i == 0)       inputSize=defaultConfiguration.getnIn();
 else       inputSize=hiddenLayerSizes[i - 1];
      if (i == 0) {
        layerWiseConfigurations.getConf(i).setnIn(inputSize);
        layerWiseConfigurations.getConf(i).setnOut(hiddenLayerSizes[i]);
        layers[i]=createHiddenLayer(i,layerInput);
      }
 else {
        if (input != null)         layerInput=activationFromPrevLayer(i - 1,layerInput);
        layerWiseConfigurations.getConf(i).setnIn(inputSize);
        layerWiseConfigurations.getConf(i).setnOut(hiddenLayerSizes[i]);
        layers[i]=createHiddenLayer(i,layerInput);
      }
      this.neuralNets[i]=createLayer(layerInput,this.layers[i].getW(),this.layers[i].getB(),null,i);
    }
  }
  NeuralNetConfiguration last=layerWiseConfigurations.getConf(layerWiseConfigurations.getConfs().size() - 1);
  NeuralNetConfiguration secondToLast=layerWiseConfigurations.getConf(layerWiseConfigurations.getConfs().size() - 2);
  last.setnIn(secondToLast.getnOut());
  this.layers[layers.length - 1]=new OutputLayer.Builder().configure(last).build();
  dimensionCheck();
  applyTransforms();
  initCalled=true;
  initMask();
}
