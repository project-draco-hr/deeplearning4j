{
  if (message instanceof DistributedPubSubMediator.SubscribeAck || message instanceof DistributedPubSubMediator.UnsubscribeAck) {
    log.info("Susbcribed batch actor");
    mediator.tell(new DistributedPubSubMediator.Publish(ClusterListener.TOPICS,message),getSelf());
  }
 else   if (message instanceof ResetMessage) {
    iter.reset();
    if (iter.hasNext()) {
      log.info("Propagating new work to master");
      mediator.tell(new DistributedPubSubMediator.Publish(MasterActor.MASTER,iter.next()),mediator);
    }
 else     if (!iter.hasNext()) {
      mediator.tell(new DistributedPubSubMediator.Publish(MasterActor.MASTER,DoneMessage.getInstance()),mediator);
    }
  }
 else   if (message instanceof MoreWorkMessage) {
    MoreWorkMessage m=(MoreWorkMessage)message;
    UpdateableImpl result=(UpdateableImpl)m.getUpdateable();
    UpdateableImpl save=SerializationUtils.clone(result);
    log.info("Saving model");
    mediator.tell(new DistributedPubSubMediator.Publish(ModelSavingActor.SAVE,save),mediator);
    if (iter.hasNext()) {
      log.info("Propagating new work to master");
      int numWorkers=stateTracker.numWorkers();
      int miniBatchSize=conf.getSplit();
      log.info("Number of workers " + numWorkers + " and batch size is "+ miniBatchSize);
      int batch=numWorkers * miniBatchSize;
      log.info("Batch size for worker is " + batch);
      DataSet next=iter.next(batch);
      mediator.tell(new DistributedPubSubMediator.Publish(MasterActor.MASTER,next),mediator);
    }
 else     if (!iter.hasNext()) {
      mediator.tell(new DistributedPubSubMediator.Publish(MasterActor.MASTER,DoneMessage.getInstance()),mediator);
    }
 else     unhandled(message);
  }
}
