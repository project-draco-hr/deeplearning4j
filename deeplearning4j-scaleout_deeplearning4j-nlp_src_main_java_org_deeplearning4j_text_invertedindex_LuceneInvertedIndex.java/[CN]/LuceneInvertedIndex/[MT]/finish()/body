{
  if (cache) {
    indexManager.execute(new Runnable(){
      public void run(){
        try {
          if (dir == null)           dir=FSDirectory.open(new File(INDEX_PATH));
          if (writer == null)           if (!indexBeingCreated.get())           writer=new IndexWriter(dir,iwc);
 else           waitOnWriter();
          writer.forceMerge(1);
          writer.commit();
          initReader();
          numDocs=reader.numDocs();
        }
 catch (        IOException e) {
          e.printStackTrace();
        }
      }
    }
);
  }
 else {
    try {
      writer.forceMerge(1);
      writer.commit();
      while (writer.hasPendingMerges() || writer.hasUncommittedChanges()) {
        try {
          Thread.sleep(10000);
          log.info("Waiting on writer....");
        }
 catch (        InterruptedException e) {
          Thread.currentThread().interrupt();
        }
      }
    }
 catch (    IOException e) {
      e.printStackTrace();
    }
    initReader();
    numDocs=reader.numDocs();
    try {
      reader.close();
    }
 catch (    IOException e) {
      e.printStackTrace();
    }
  }
  finishedCalled=new AtomicLong(System.currentTimeMillis());
}
