{
  if (!miniBatch)   throw new IllegalStateException("Mini batch mode turned off");
  if (!miniBatches.isEmpty())   return miniBatches.remove(0);
 else   if (miniBatchGoing.get()) {
    while (miniBatches.isEmpty()) {
      try {
        Thread.sleep(1000);
      }
 catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
      }
      log.warn("Waiting on more data...");
      if (!miniBatches.isEmpty())       return miniBatches.remove(0);
    }
  }
  return null;
}
