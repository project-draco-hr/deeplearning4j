{
  if (useCurrent) {
    useCurrent=false;
    if (preProcessor != null)     preProcessor.preProcess(last);
    return last;
  }
  List<DataSet> dataSets=new ArrayList<>();
  for (int i=0; i < num; i++) {
    if (!hasNext())     break;
    if (recordReader instanceof SequenceRecordReader) {
      if (sequenceIter == null || !sequenceIter.hasNext()) {
        Collection<Collection<Writable>> sequenceRecord=((SequenceRecordReader)recordReader).sequenceRecord();
        sequenceIter=sequenceRecord.iterator();
      }
      Collection<Writable> record=sequenceIter.next();
      dataSets.add(getDataSet(record));
    }
 else {
      Collection<Writable> record=recordReader.next();
      dataSets.add(getDataSet(record));
    }
  }
  batchNum++;
  List<INDArray> inputs=new ArrayList<>();
  List<INDArray> labels=new ArrayList<>();
  for (  DataSet data : dataSets) {
    inputs.add(data.getFeatureMatrix());
    labels.add(data.getLabels());
  }
  if (inputs.isEmpty()) {
    notOvershot=false;
    return last;
  }
 else   if (maxNumBatches > -1 && batchNum >= maxNumBatches) {
    notOvershot=false;
  }
  DataSet ret=new DataSet(Nd4j.vstack(inputs.toArray(new INDArray[0])),Nd4j.vstack(labels.toArray(new INDArray[0])));
  last=ret;
  if (preProcessor != null)   preProcessor.preProcess(ret);
  return ret;
}
