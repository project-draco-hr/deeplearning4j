{
  List<Writable> currList;
  if (record instanceof List)   currList=(List<Writable>)record;
 else   currList=new ArrayList<>(record);
  if (numPossibleLabels >= 1 && labelIndex < 0) {
    labelIndex=record.size() - 1;
  }
  INDArray label=null;
  INDArray featureVector=Nd4j.create(labelIndex >= 0 ? currList.size() - 1 : currList.size());
  for (int j=0; j < currList.size(); j++) {
    Writable current=currList.get(j);
    if (current.toString().isEmpty())     continue;
    if (labelIndex >= 0 && j == labelIndex) {
      if (converter != null)       try {
        current=converter.convert(current);
      }
 catch (      WritableConverterException e) {
        e.printStackTrace();
      }
      if (numPossibleLabels < 1)       throw new IllegalStateException("Number of possible labels invalid, must be >= 1");
      if (regression) {
        label=Nd4j.scalar(current.toDouble());
      }
 else {
        int curr=current.toInt();
        if (curr >= numPossibleLabels)         curr--;
        label=FeatureUtil.toOutcomeVector(curr,numPossibleLabels);
      }
    }
 else {
      featureVector.putScalar(j,current.toDouble());
    }
  }
  return new DataSet(featureVector,labelIndex >= 0 ? label : featureVector);
}
