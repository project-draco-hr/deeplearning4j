{
  ClassPathResource resource=new ClassPathResource("big/raw_sentences.txt");
  File file=resource.getFile();
  iter=new LineSentenceIterator(file);
  iter.setPreProcessor(new SentencePreProcessor(){
    @Override public String preProcess(    String sentence){
      return sentence.toLowerCase();
    }
  }
);
  vocabCache=new InMemoryLookupCache();
  textVectorizer=new TfidfVectorizer.Builder().tokenize(tokenizerFactory).cache(vocabCache).iterate(iter).minWords(1).stopWords(new ArrayList<String>()).build();
  textVectorizer.fit();
  coOccurrences=new CoOccurrences.Builder().cache(vocabCache).iterate(iter).symmetric(false).tokenizer(tokenizerFactory).windowSize(15).build();
  coOccurrences.fit();
  List<String> occurrences=IOUtils.readLines(new ClassPathResource("big/occurrences.txt").getInputStream());
  for (int i=0; i < occurrences.size(); i++) {
    String[] split=occurrences.get(i).split(" ");
    assertEquals(i,Integer.parseInt(split[0]));
    assertEquals("Failed on id " + i,Double.parseDouble(split[1]),coOccurrences.getSentenceOccurrences().getCount(i),6);
  }
  log.info(String.valueOf(coOccurrences.numCoOccurrences()));
}
