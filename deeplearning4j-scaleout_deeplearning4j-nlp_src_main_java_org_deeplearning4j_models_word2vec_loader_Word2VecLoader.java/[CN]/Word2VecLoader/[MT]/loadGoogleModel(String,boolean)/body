{
  WeightLookupTable lookupTable;
  VocabCache cache;
  float[][] data;
  if (binary) {
    DataInputStream dis=null;
    BufferedInputStream bis=null;
    double len;
    float vector;
    int words=0, size=0;
    try {
      bis=new BufferedInputStream(new FileInputStream(path));
      dis=new DataInputStream(bis);
      words=Integer.parseInt(readString(dis));
      size=Integer.parseInt(readString(dis));
      data=new float[words][size];
      cache=new InMemoryLookupCache();
      lookupTable=new InMemoryLookupTable.Builder().vectorLength(size).build();
      String word;
      float[] vectors;
      for (int i=0; i < words; i++) {
        word=readString(dis);
        vectors=new float[size];
        len=0;
        for (int j=0; j < size; j++) {
          vector=readFloat(dis);
          len+=vector * vector;
          vectors[j]=vector;
        }
        len=Math.sqrt(len);
        for (int j=0; j < size; j++)         vectors[j]/=len;
        data[i]=vectors;
        cache.addWordToIndex(cache.numWords(),word);
        cache.addToken(new VocabWord(1,word));
        cache.putVocabWord(word);
        dis.read();
      }
    }
  finally {
      bis.close();
      dis.close();
    }
    Word2Vec ret=new Word2Vec();
    lookupTable.resetWeights();
    for (int i=0; i < data.length; i++)     lookupTable.putVector(cache.wordAtIndex(i),Nd4j.create(new FloatBuffer(data[i])));
    ret.setCache(cache);
    ret.setLookupTable(lookupTable);
    ret.setLayerSize(size);
    return ret;
  }
 else {
    BufferedReader reader=new BufferedReader(new FileReader(new File(path)));
    String line=reader.readLine();
    String[] initial=line.split(" ");
    int words=Integer.parseInt(initial[0]);
    int layerSize=Integer.parseInt(initial[1]);
    cache=new InMemoryLookupCache();
    data=new float[words][layerSize];
    int count=0;
    while ((line=reader.readLine()) != null) {
      String[] split=line.split(" ");
      String word=split[0];
      float[] buffer=new float[layerSize];
      for (int i=1; i < split.length; i++) {
        buffer[i - 1]=Float.parseFloat(split[i]);
      }
      data[count++]=buffer;
      cache.addWordToIndex(cache.numWords(),word);
      cache.addToken(new VocabWord(1,word));
      cache.putVocabWord(word);
    }
    lookupTable=new InMemoryLookupTable.Builder().cache(cache).vectorLength(layerSize).build();
    lookupTable.resetWeights();
    for (int i=0; i < data.length; i++)     lookupTable.putVector(cache.wordAtIndex(i),Nd4j.create(new FloatBuffer(data[i])));
    Word2Vec ret=new Word2Vec();
    ret.setCache(cache);
    ret.setLayerSize(layerSize);
    return ret;
  }
}
