{
  DoubleMatrix p_y_given_x=softmax(network.logLayer.input.mmul(network.logLayer.W).addRowVector(network.logLayer.b));
  DoubleMatrix dy=network.logLayer.labels.sub(p_y_given_x);
  int idx=0;
  DoubleMatrix weightGradient=network.logLayer.input.transpose().mmul(dy).mul(lr);
  DoubleMatrix biasGradient=dy.columnMeans().mul(lr);
  for (int i=0; i < weightGradient.length; i++)   buffer[idx++]=weightGradient.get(i);
  for (int i=0; i < biasGradient.length; i++)   buffer[idx++]=biasGradient.get(i);
}
