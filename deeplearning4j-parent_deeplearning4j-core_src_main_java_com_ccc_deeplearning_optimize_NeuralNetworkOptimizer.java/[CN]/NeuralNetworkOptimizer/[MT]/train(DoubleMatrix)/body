{
  if (opt == null)   opt=new ConjugateGradient(this);
  boolean done=false;
  network.train(x,lr,extraParams);
  int numErrorsCaught=0;
  while (!done) {
    try {
      done=opt.optimize();
    }
 catch (    InvalidOptimizableException e) {
      network.train(x,lr,extraParams);
      numErrorsCaught++;
      if (numErrorsCaught >= 5) {
        log.warn("Too many invalid line searches; breaking");
        break;
      }
      log.warn("Invalid step taken; trying again. Error was ",e);
    }
catch (    OptimizationException e2) {
      network.train(x,lr,extraParams);
      numErrorsCaught++;
      if (numErrorsCaught >= 5) {
        log.warn("Too many invalid line searches; breaking");
        break;
      }
      log.warn("Invalid step taken; trying again. Error was ",e2);
    }
  }
}
