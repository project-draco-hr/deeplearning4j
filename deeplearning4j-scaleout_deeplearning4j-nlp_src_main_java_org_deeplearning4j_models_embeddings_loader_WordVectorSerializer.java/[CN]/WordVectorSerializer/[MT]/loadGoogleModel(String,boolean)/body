{
  InMemoryLookupTable lookupTable;
  VocabCache cache;
  INDArray syn0;
  if (binary) {
    float vector;
    int words, size;
    try (BufferedInputStream bis=new BufferedInputStream(path.endsWith(".gz") ? new GZIPInputStream(new FileInputStream(path)) : new FileInputStream(path));DataInputStream dis=new DataInputStream(bis)){
      words=Integer.parseInt(readString(dis));
      size=Integer.parseInt(readString(dis));
      syn0=Nd4j.create(words,size);
      cache=new InMemoryLookupCache(false);
      lookupTable=(InMemoryLookupTable)new InMemoryLookupTable.Builder().cache(cache).vectorLength(size).build();
      String word;
      for (int i=0; i < words; i++) {
        word=readString(dis);
        log.info("Loading " + word + " with word "+ i);
        if (word.isEmpty())         continue;
        for (int j=0; j < size; j++) {
          vector=dis.readFloat();
          syn0.put(i,j,vector);
        }
        cache.addWordToIndex(cache.numWords(),word);
        cache.addToken(new VocabWord(1,word));
        cache.putVocabWord(word);
      }
    }
     Word2Vec ret=new Word2Vec();
    lookupTable.setSyn0(syn0);
    ret.setVocab(cache);
    ret.setLookupTable(lookupTable);
    return ret;
  }
 else {
    BufferedReader reader=new BufferedReader(new FileReader(new File(path)));
    String line=reader.readLine();
    String[] initial=line.split(" ");
    int words=Integer.parseInt(initial[0]);
    int layerSize=Integer.parseInt(initial[1]);
    syn0=Nd4j.create(words,layerSize);
    cache=new InMemoryLookupCache();
    int currLine=0;
    while ((line=reader.readLine()) != null) {
      String[] split=line.split(" ");
      String word=split[0];
      if (word.isEmpty())       continue;
      for (int i=1; i < split.length; i++) {
        syn0.put(currLine,i - 1,Float.parseFloat(split[i]));
      }
      cache.addWordToIndex(cache.numWords(),word);
      cache.addToken(new VocabWord(1,word));
      cache.putVocabWord(word);
    }
    lookupTable=(InMemoryLookupTable)new InMemoryLookupTable.Builder().cache(cache).vectorLength(layerSize).build();
    lookupTable.setSyn0(syn0);
    Word2Vec ret=new Word2Vec();
    ret.setVocab(cache);
    ret.setLookupTable(lookupTable);
    reader.close();
    return ret;
  }
}
