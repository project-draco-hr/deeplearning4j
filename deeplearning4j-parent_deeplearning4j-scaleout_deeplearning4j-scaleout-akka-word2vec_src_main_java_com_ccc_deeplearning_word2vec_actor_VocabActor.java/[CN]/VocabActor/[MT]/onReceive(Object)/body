{
  if (message instanceof VocabMessage) {
    VocabMessage m=(VocabMessage)message;
    Counter<String> rawVocab=m.getRawVocab();
    List<String> tokens=m.getTokens();
    List<String> stopWords=m.getStopWords();
    int minWordFrequency=m.getMinWordFrequency();
    Index wordIndex=m.getWordIndex();
    Map<String,VocabWord> vocab=m.getVocab();
    int layerSize=m.getLayerSize();
    AtomicLong lastUpdate=m.getChangeTracker();
    for (    String token : tokens) {
      if (stopWords.contains(token))       token="STOP";
      rawVocab.incrementCount(token,1.0);
      if (rawVocab.getCount(token) >= minWordFrequency && !Util.matchesAnyStopWord(stopWords,token)) {
        if (!vocab.containsKey(token)) {
          VocabWord word=new VocabWord(rawVocab.getCount(token),layerSize);
          word.setIndex(vocab.size());
          vocab.put(token,word);
          wordIndex.add(token);
        }
      }
    }
    lastUpdate.getAndSet(System.currentTimeMillis());
  }
 else   unhandled(message);
}
