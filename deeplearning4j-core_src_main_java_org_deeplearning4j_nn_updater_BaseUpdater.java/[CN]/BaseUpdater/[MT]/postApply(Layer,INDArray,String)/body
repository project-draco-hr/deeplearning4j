{
  NeuralNetConfiguration conf=layer.conf();
  INDArray params=layer.getParam(param);
  if (conf.isUseRegularization() && conf.getL2() > 0 && !(param.equals(DefaultParamInitializer.BIAS_KEY)))   gradient.addi(params.mul(conf.getL2() / layer.input().size(0)));
  if (conf.isUseRegularization() && conf.getL1() > 0 && !(param.equals(DefaultParamInitializer.BIAS_KEY)))   gradient.addi(Transforms.sign(params).muli(conf.getL1() / layer.input().size(0)));
  if (conf.isMiniBatch())   gradient.divi(((double)layer.input().size(0)) / conf.getTimeSeriesLength());
  if (conf.isConstrainGradientToUnitNorm())   gradient.divi(gradient.norm2(Integer.MAX_VALUE));
}
