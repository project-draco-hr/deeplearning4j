{
  for (  String variable : gradient.gradientForVariable().keySet()) {
    AdaGrad adaGradForVariable=adaGrad.get(variable);
    INDArray lastStepForVariable=stepCache.get(variable);
    if (adaGradForVariable == null) {
      adaGradForVariable=new AdaGrad(model.getParam(variable).shape());
      adaGrad.put(variable,adaGradForVariable);
    }
    if (lastStepForVariable == null) {
      lastStepForVariable=Nd4j.ones((model.getParam(variable).shape()));
      stepCache.put(variable,lastStepForVariable);
    }
    updateGradientAccordingToParams(variable,conf,iteration,adaGradForVariable,gradient.getGradientFor(variable),model.getParam(variable),stepCache.get(variable),batchSize);
  }
}
