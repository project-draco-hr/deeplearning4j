{
  double cost=0.0f;
  for (  MultiDimensionalMap.Entry<String,String,INDArray> entry : currentMatrices.entrySet()) {
    INDArray D=derivatives.get(entry.getFirstKey(),entry.getSecondKey());
    if (D.data().dataType() == DataBuffer.DOUBLE)     D=Nd4j.getBlasWrapper().scal(scale,D).addi(Nd4j.getBlasWrapper().scal(regCost,entry.getValue()));
 else     D=Nd4j.getBlasWrapper().scal((float)scale,D).addi(Nd4j.getBlasWrapper().scal((float)regCost,entry.getValue()));
    derivatives.put(entry.getFirstKey(),entry.getSecondKey(),D);
    cost+=entry.getValue().mul(entry.getValue()).sum(Integer.MAX_VALUE).getDouble(0) * regCost / 2.0;
  }
  return cost;
}
