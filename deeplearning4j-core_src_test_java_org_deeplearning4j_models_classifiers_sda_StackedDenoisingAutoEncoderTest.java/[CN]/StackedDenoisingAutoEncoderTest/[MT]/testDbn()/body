{
  final RandomGenerator gen=new MersenneTwister(123);
  DataSetIterator iter=new MnistDataSetIterator(10,10);
  DataSet d2=iter.next();
  MultiLayerConfiguration conf=new NeuralNetConfiguration.Builder().momentum(5e-1f).weightInit(WeightInit.SIZE).constrainGradientToUnitNorm(false).withActivationType(NeuralNetConfiguration.ActivationType.SAMPLE).iterations(10).lossFunction(LossFunctions.LossFunction.RECONSTRUCTION_CROSSENTROPY).rng(gen).optimizationAlgo(NeuralNetwork.OptimizationAlgorithm.HESSIAN_FREE).learningRate(1e-1f).nIn(d2.numInputs()).nOut(d2.numOutcomes()).list(4).hiddenLayerSizes(new int[]{600,300,200}).override(new NeuralNetConfiguration.ConfOverride(){
    @Override public void override(    int i,    NeuralNetConfiguration.Builder builder){
      if (i == 3) {
        builder.weightInit(WeightInit.ZERO);
        builder.activationFunction(Activations.softMaxRows());
        builder.lossFunction(LossFunctions.LossFunction.MCXENT);
      }
    }
  }
).build();
  StackedDenoisingAutoEncoder d=new StackedDenoisingAutoEncoder.Builder().layerWiseConfiguration(conf).build();
  d.fit(d2);
  while (iter.hasNext()) {
    d2=iter.next();
    d.fit(d2);
  }
  INDArray predict2=d.output(d2.getFeatureMatrix());
  Evaluation eval=new Evaluation();
  eval.eval(d2.getLabels(),predict2);
  log.info(eval.stats());
  int[] predict=d.predict(d2.getFeatureMatrix());
  log.info("Predict " + Arrays.toString(predict));
}
