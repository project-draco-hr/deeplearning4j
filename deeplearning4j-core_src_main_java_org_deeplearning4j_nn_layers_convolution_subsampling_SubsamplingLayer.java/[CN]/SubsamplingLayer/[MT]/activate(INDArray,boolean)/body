{
  if (training && conf.getDropOut() > 0) {
    this.dropoutMask=Dropout.applyDropout(input,conf.getDropOut(),dropoutMask);
  }
  INDArray pooled=Convolution.im2col(input,conf.getKernelSize(),conf.getStride(),conf.getPadding());
switch (conf.getPoolingType()) {
case AVG:
    return pooled.mean(2,3);
case MAX:
  int n=pooled.size(0);
int c=pooled.size(1);
int kh=pooled.size(2);
int kw=pooled.size(3);
int outWidth=pooled.size(4);
int outHeight=pooled.size(5);
INDArray ret=pooled.reshape(n,c,kh * kw,outHeight,outWidth);
return ret.max(2);
default :
throw new IllegalStateException("Pooling type not supported!");
}
}
