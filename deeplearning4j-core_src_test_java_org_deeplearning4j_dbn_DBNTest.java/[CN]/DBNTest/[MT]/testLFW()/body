{
  DataSetIterator iter=new LFWDataSetIterator(10,10,14,14);
  GaussianRectifiedLinearDBN dbn=new GaussianRectifiedLinearDBN.Builder().useAdaGrad(true).hiddenLayerSizes(new int[]{250,150,100}).normalizeByInputRows(true).withOptimizationAlgorithm(NeuralNetwork.OptimizationAlgorithm.CONJUGATE_GRADIENT).numberOfInputs(iter.inputColumns()).numberOfOutPuts(iter.totalOutcomes()).build();
  while (iter.hasNext()) {
    DataSet next=iter.next();
    next.normalizeZeroMeanZeroUnitVariance();
    ;
    dbn.pretrain(next.getFirst(),1,1e-5,10000);
  }
  iter.reset();
  while (iter.hasNext()) {
    DataSet next=iter.next();
    next.normalizeZeroMeanZeroUnitVariance();
    ;
    dbn.setInput(next.getFirst());
    dbn.finetune(next.getSecond(),1e-4,10000);
  }
  iter.reset();
  Evaluation eval=new Evaluation();
  while (iter.hasNext()) {
    DataSet next=iter.next();
    DoubleMatrix predict=dbn.predict(next.getFirst());
    DoubleMatrix labels=next.getSecond();
    eval.eval(labels,predict);
  }
  log.info("Prediction f scores and accuracy");
  log.info(eval.stats());
}
