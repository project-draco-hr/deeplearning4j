{
  long n=data.count();
  JavaRDD<Double> scores=data.mapPartitions(new ScoreFlatMapFunctionCGMultiDataSet(conf.toJson(),sc.broadcast(network.params(false))));
  List<Double> scoresList=scores.collect();
  double sum=0.0;
  for (  Double d : scoresList)   sum+=d;
  if (average)   return sum / n;
  return sum;
}
