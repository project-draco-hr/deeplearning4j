{
  if (layer == null)   throw new IllegalStateException("No layer defined.");
  NeuralNetConfiguration conf=new NeuralNetConfiguration();
  conf.minimize=minimize;
  conf.maxNumLineSearchIterations=maxNumLineSearchIterations;
  conf.l1=(!Double.isNaN(layer.getL1()) ? layer.getL1() : l1);
  conf.batchSize=batchSize;
  conf.layer=layer;
  conf.lr=(!Double.isNaN(layer.getLr()) ? layer.getLr() : lr);
  conf.numIterations=numIterations;
  conf.momentum=momentum;
  conf.l2=(!Double.isNaN(layer.getL2()) ? layer.getL2() : l2);
  conf.useRegularization=useRegularization;
  conf.momentumAfter=momentumAfter;
  conf.optimizationAlgo=optimizationAlgo;
  conf.constrainGradientToUnitNorm=constrainGradientToUnitNorm;
  conf.seed=seed;
  conf.timeSeriesLength=timeSeriesLength;
  conf.rmsDecay=rmsDecay;
  conf.stepFunction=stepFunction;
  conf.useDropConnect=useDropConnect;
  conf.miniBatch=miniBatch;
  conf.rho=rho;
  conf.meanDecay=meanDecay;
  conf.varDecay=varDecay;
  return conf;
}
