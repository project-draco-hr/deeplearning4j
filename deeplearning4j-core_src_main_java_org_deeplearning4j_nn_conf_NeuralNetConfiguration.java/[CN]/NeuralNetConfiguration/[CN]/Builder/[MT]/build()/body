{
  if (layer == null)   throw new IllegalStateException("No layer defined.");
  NeuralNetConfiguration ret=new NeuralNetConfiguration(useAdaGrad,lr,numIterations,momentum,l2,useRegularization,momentumAfter,resetAdaGradIterations,optimizationAlgo,lossFunction,constrainGradientToUnitNorm,seed,nIn,nOut,weightShape,timeSeriesLength,kernelSize,stride,padding,batchSize,maxNumLineSearchIterations,minimize,layer,convolutionType,poolingType,l1,customLossFunction);
  ret.padding=this.padding;
  ret.stride=this.stride;
  ret.useAdaGrad=this.useAdaGrad;
  ret.rmsDecay=rmsDecay;
  ret.stepFunction=stepFunction;
  ret.useDropConnect=useDropConnect;
  ret.miniBatch=miniBatch;
  ret.rho=rho;
  ret=overrideFields(ret,layer);
  return ret;
}
