{
  final int batchSize=miniBatches;
  return toSplitJava.mapPartitions(new FlatMapFunction<Iterator<DataSet>,DataSet>(){
    @Override public Iterable<DataSet> call(    Iterator<DataSet> dataSetIterator) throws Exception {
      List<DataSet> ret=new ArrayList<>();
      List<DataSet> temp=new ArrayList<>();
      while (dataSetIterator.hasNext()) {
        temp.add(dataSetIterator.next());
        if (temp.size() == batchSize) {
          ret.add(DataSet.merge(temp));
          temp.clear();
        }
      }
      if (!temp.isEmpty())       ret.add(DataSet.merge(temp));
      return ret;
    }
  }
);
}
