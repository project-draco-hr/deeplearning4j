{
  Tensor eHid=propUp(input);
  Tensor I=Tensor.zeros(eHid.rows(),eHid.columns(),eHid.slices());
  for (int i=0; i < W.slices(); i++) {
    I.setSlice(i,Convolution.conv2d(input,MatrixUtil.reverse(W.getSlice(i)),Convolution.Type.VALID).add(hBias.get(i)));
  }
  Tensor ret=Tensor.ones(I.rows(),I.columns(),I.slices());
  Tensor poolExpI=pool(I.exp()).add(1);
  Tensor sub=ret.div(poolExpI);
  ret.subi(sub);
  return ret;
}
