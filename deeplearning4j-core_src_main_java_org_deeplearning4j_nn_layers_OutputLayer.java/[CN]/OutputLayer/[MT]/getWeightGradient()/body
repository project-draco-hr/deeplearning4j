{
  INDArray z=output(input);
switch (conf.getLossFunction()) {
case MCXENT:
    INDArray p_y_given_x=sigmoid(input.mmul(W).addRowVector(b));
  INDArray dy=labels.sub(p_y_given_x);
return input.transpose().mmul(dy);
case XENT:
INDArray xEntDiff=z.sub(labels);
return input.transpose().mmul(xEntDiff.div(z.mul(z.rsub(1))));
case MSE:
INDArray mseDelta=labels.sub(z);
return input.transpose().mmul(mseDelta.neg());
case EXPLL:
return input.transpose().mmul(labels.rsub(1).divi(z));
case RMSE_XENT:
return input.transpose().mmul(pow(labels.sub(z),2));
case SQUARED_LOSS:
return input.transpose().mmul(pow(labels.sub(z),2));
}
throw new IllegalStateException("Invalid loss function");
}
