{
  double p=1 - corruption_level;
  DoubleMatrix tilde_x=get_corrupted_input(x,p);
  DoubleMatrix y=get_hidden_values(tilde_x);
  DoubleMatrix z=get_reconstructed_input(y);
  DoubleMatrix L_h2=x.sub(z);
  DoubleMatrix L_h1=L_h2.mmul(W).mul(y).mul(DoubleMatrix.ones(y.length).sub(y));
  DoubleMatrix L_vbias=L_h2;
  DoubleMatrix L_hbias=L_h1;
  DoubleMatrix L_W=tilde_x.transpose().mmul(L_h1).add(L_h2.transpose().mmul(y));
  DoubleMatrix learnMulL_W=L_W.mul(lr);
  this.W=W.add(learnMulL_W);
  DoubleMatrix L_hbias_mean=MatrixUtil.columnWiseMean(L_hbias,0);
  DoubleMatrix L_vbias_mean=MatrixUtil.columnWiseMean(L_vbias,0);
  L_hbias_mean=L_hbias_mean.mul(lr);
  L_vbias_mean=L_vbias_mean.mul(lr);
  this.hbias=hbias.add(L_hbias_mean);
  this.vbias=vbias.add(L_vbias_mean);
}
