{
  if (layerWiseConfigurations == null || layers == null) {
    intializeConfigurations();
  }
  INDArray layerInput=input;
  int inputSize;
  if (getnLayers() < 1)   throw new IllegalStateException("Unable to createComplex network neuralNets; number specified is less than 1");
  int[] hiddenLayerSizes=layerWiseConfigurations.getHiddenLayerSizes();
  if (this.layers == null || this.layers[0] == null) {
    this.layers=new Layer[hiddenLayerSizes.length + 1];
    for (int i=0; i < this.getnLayers(); i++) {
      if (i == 0)       inputSize=defaultConfiguration.getnIn();
 else       inputSize=hiddenLayerSizes[i - 1];
      if (i == 0) {
        layerWiseConfigurations.getConf(i).setnIn(inputSize);
        layerWiseConfigurations.getConf(i).setnOut(hiddenLayerSizes[i]);
        layers[i]=layerFactories[i].create(layerWiseConfigurations.getConf(i));
      }
 else {
        if (input != null)         layerInput=activationFromPrevLayer(i - 1,layerInput);
        layerWiseConfigurations.getConf(i).setnIn(inputSize);
        layerWiseConfigurations.getConf(i).setnOut(hiddenLayerSizes[i]);
      }
    }
  }
  NeuralNetConfiguration last=layerWiseConfigurations.getConf(layerWiseConfigurations.getConfs().size() - 1);
  NeuralNetConfiguration secondToLast=layerWiseConfigurations.getConf(layerWiseConfigurations.getConfs().size() - 2);
  last.setnIn(secondToLast.getnOut());
  this.layers[layers.length - 1]=layerFactories[layers.length - 1].create(last);
  initCalled=true;
  initMask();
}
