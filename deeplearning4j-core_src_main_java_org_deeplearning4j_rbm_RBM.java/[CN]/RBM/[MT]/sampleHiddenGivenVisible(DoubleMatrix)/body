{
  if (hiddenType == HiddenUnit.RECTIFIED) {
    DoubleMatrix h1Mean=propUp(v);
    DoubleMatrix sigH1Mean=sigmoid(h1Mean);
    DoubleMatrix sqrtSigH1Mean=sqrt(sigH1Mean);
    DoubleMatrix h1Sample=h1Mean.addi(normal(getRng(),h1Mean,1).mul(sqrtSigH1Mean));
    MatrixUtil.max(0.0,h1Sample);
    applyDropOutIfNecessary(h1Sample);
    return new Pair<>(h1Mean,h1Sample);
  }
 else   if (hiddenType == HiddenUnit.GAUSSIAN) {
    DoubleMatrix h1Mean=propUp(v);
    this.hiddenSigma=columnVariance(h1Mean);
    DoubleMatrix h1Sample=h1Mean.addi(normal(getRng(),h1Mean,this.hiddenSigma));
    applyDropOutIfNecessary(h1Sample);
    return new Pair<>(h1Mean,h1Sample);
  }
 else   if (hiddenType == HiddenUnit.SOFTMAX) {
    DoubleMatrix h1Mean=propUp(v);
    DoubleMatrix h1Sample=softmax(h1Mean);
    applyDropOutIfNecessary(h1Sample);
    return new Pair<>(h1Mean,h1Sample);
  }
 else   if (hiddenType == HiddenUnit.BINARY) {
    DoubleMatrix h1Mean=propUp(v);
    DoubleMatrix h1Sample=binomial(h1Mean,1,rng);
    applyDropOutIfNecessary(h1Sample);
    return new Pair<>(h1Mean,h1Sample);
  }
  throw new IllegalStateException("Hidden unit type must either be rectified linear or binary");
}
