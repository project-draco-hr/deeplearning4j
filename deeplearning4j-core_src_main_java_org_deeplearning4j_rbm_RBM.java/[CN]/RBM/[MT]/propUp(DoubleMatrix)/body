{
  if (visibleType == VisibleUnit.GAUSSIAN)   this.sigma=columnVariance(v).divi(input.rows);
  DoubleMatrix preSig=v.mmul(W);
  if (concatBiases)   preSig=DoubleMatrix.concatHorizontally(preSig,hBias);
 else   preSig.addiRowVector(hBias);
  if (hiddenType == HiddenUnit.RECTIFIED) {
    max(0,preSig);
    return preSig;
  }
 else   if (hiddenType == HiddenUnit.GAUSSIAN) {
    DoubleMatrix add=preSig.add(MatrixUtil.randn(rng,preSig.rows,preSig.columns));
    preSig.addi(add);
    return preSig;
  }
 else   if (hiddenType == HiddenUnit.BINARY) {
    return sigmoid(preSig);
  }
 else   if (hiddenType == HiddenUnit.SOFTMAX)   return softmax(preSig);
  throw new IllegalStateException("Hidden unit type should either be binary, gaussian, or rectified linear");
}
