{
  if (job.getWork() instanceof Word2VecWork) {
    double numWordsSoFar=stateTracker.count(NUM_WORDS_SO_FAR);
    Word2VecWork work=(Word2VecWork)job.getWork();
    List<VocabWord> sentence=work.getSentence();
    double alpha2=Math.max(minAlpha,alpha * (1 - (1.0 * numWordsSoFar / (double)totalWords)));
    trainSentence(sentence,work,alpha2);
    int totalNewWords=work.getSentence().size();
    job.setResult((Serializable)Arrays.asList(work.addDeltas()));
    stateTracker.increment(NUM_WORDS_SO_FAR,totalNewWords);
  }
 else   if (job.getWork() instanceof Collection) {
    double numWordsSoFar=stateTracker.count(NUM_WORDS_SO_FAR);
    Collection<Word2VecWork> coll=(Collection<Word2VecWork>)job.getWork();
    double alpha2=Math.max(minAlpha,alpha * (1 - (1.0 * numWordsSoFar / (double)totalWords)));
    int totalNewWords=0;
    List<Word2VecResult> deltas=new ArrayList<>();
    for (    Word2VecWork work : coll) {
      List<VocabWord> sentence=work.getSentence();
      trainSentence(sentence,work,alpha2);
      totalNewWords+=sentence.size();
      deltas.add(work.addDeltas());
    }
    job.setResult((Serializable)deltas);
    stateTracker.increment(NUM_WORDS_SO_FAR,totalNewWords);
  }
}
