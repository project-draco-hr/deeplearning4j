{
  if (network.conf().getListeners() != null && !network.conf().getListeners().isEmpty()) {
    Set<IterationListener> listeners=new HashSet<>(network.conf().getListeners());
    listeners.add(this);
    jointListeners=new ComposableIterationListener(listeners);
  }
  if (network.conf().getOptimizationAlgo() == OptimizationAlgorithm.CONJUGATE_GRADIENT) {
    opt=new VectorizedNonZeroStoppingConjugateGradient(this,jointListeners != null ? jointListeners : this);
    opt.setTolerance(tolerance);
  }
 else   if (network.conf().getOptimizationAlgo() == OptimizationAlgorithm.ITERATION_GRADIENT_DESCENT) {
    opt=new IterationGradientDescent(this,jointListeners != null ? jointListeners : this,network.conf().getNumIterations());
  }
 else {
    opt=new VectorizedDeepLearningGradientAscent(this,jointListeners != null ? jointListeners : this);
    opt.setTolerance(tolerance);
    if (maxStep > 0)     ((VectorizedDeepLearningGradientAscent)opt).setMaxStepSize(maxStep);
  }
}
