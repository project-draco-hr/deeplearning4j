{
  log.info("Stored master path of " + conf.getMasterAbsPath());
  Future<Void> f=Futures.future(new Callable<Void>(){
    @Override public Void call() throws Exception {
      log.info("Registering with zookeeper; if the logging stops here, ensure zookeeper is started");
      if (!PortTaken.portTaken(2181)) {
        log.info("No zookeeper found; starting an embedded zookeeper");
        startEmbeddedZooKeeper(system);
      }
      ZooKeeperConfigurationRegister reg=new ZooKeeperConfigurationRegister(conf,"master","localhost",2181);
      reg.register();
      reg.close();
      return null;
    }
  }
,system.dispatcher());
  f.onComplete(new OnComplete<Void>(){
    @Override public void onComplete(    Throwable arg0,    Void arg1) throws Throwable {
      if (arg0 != null)       throw arg0;
      log.info("Registered conf with zookeeper");
    }
  }
,system.dispatcher());
}
