{
  UpdateableImpl masterResults=null;
  Collection<String> updates=stateTracker.workerUpdates();
  if (!updates.isEmpty()) {
    masterResults=compute();
    stateTracker.setCurrent(masterResults);
    epochsComplete++;
    stateTracker.workerUpdates().clear();
  }
 else   masterResults=getMasterResults();
  if (stateTracker.isPretrain() && stateTracker.currentJobs().isEmpty()) {
    log.info("Switching to finetune mode");
    stateTracker.moveToFinetune();
    SerializationUtils.saveObject(masterResults.get(),new File("pretrain-model.bin"));
    batchActor.tell(ResetMessage.getInstance(),getSelf());
    batchActor.tell(new MoreWorkMessage(masterResults),getSelf());
  }
 else   if (stateTracker.currentJobs().isEmpty()) {
    isDone=true;
    stateTracker.finish();
    log.info("Done training!");
  }
}
