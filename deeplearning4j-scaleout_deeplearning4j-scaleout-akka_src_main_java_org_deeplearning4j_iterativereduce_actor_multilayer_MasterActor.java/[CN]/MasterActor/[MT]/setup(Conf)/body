{
  log.info("Starting workers");
  ActorSystem system=context().system();
  RoundRobinPool pool=new RoundRobinPool(Runtime.getRuntime().availableProcessors());
  Props p=pool.props(WorkerActor.propsFor(conf,stateTracker));
  p=ClusterSingletonManager.defaultProps(p,"master",PoisonPill.getInstance(),"master");
  system.actorOf(p,"worker");
  log.info("Broadcasting initial master network");
  BaseMultiLayerNetwork network=null;
  if (this.network == null) {
    if (conf.getMultiLayerClazz().isAssignableFrom(DBN.class)) {
      network=new DBN.Builder().withHiddenUnits(conf.getHiddenUnit()).withVisibleUnits(conf.getVisibleUnit()).numberOfInputs(conf.getnIn()).numberOfOutPuts(conf.getnOut()).withClazz(conf.getMultiLayerClazz()).hiddenLayerSizes(conf.getLayerSizes()).renderWeights(conf.getRenderWeightEpochs()).useRegularization(conf.isUseRegularization()).withDropOut(conf.getDropOut()).withLossFunction(conf.getLossFunction()).withSparsity(conf.getSparsity()).useAdaGrad(conf.isUseAdaGrad()).withOptimizationAlgorithm(conf.getOptimizationAlgorithm()).withMultiLayerGradientListeners(conf.getMultiLayerGradientListeners()).withGradientListeners(conf.getGradientListeners()).build();
    }
 else {
      network=new BaseMultiLayerNetwork.Builder<>().numberOfInputs(conf.getnIn()).numberOfOutPuts(conf.getnOut()).withClazz(conf.getMultiLayerClazz()).hiddenLayerSizes(conf.getLayerSizes()).renderWeights(conf.getRenderWeightEpochs()).useRegularization(conf.isUseRegularization()).withDropOut(conf.getDropOut()).withLossFunction(conf.getLossFunction()).withSparsity(conf.getSparsity()).useAdaGrad(conf.isUseAdaGrad()).withOptimizationAlgorithm(conf.getOptimizationAlgorithm()).withMultiLayerGradientListeners(conf.getMultiLayerGradientListeners()).withGradientListeners(conf.getGradientListeners()).build();
    }
  }
 else   network=this.network;
  if (conf.getColumnMeans() != null)   network.setColumnMeans(conf.getColumnMeans());
  if (conf.getColumnStds() != null)   network.setColumnStds(conf.getColumnStds());
  UpdateableImpl masterResults=new UpdateableImpl(network);
  try {
    this.stateTracker.setCurrent(masterResults);
    UpdateableImpl u2=this.stateTracker.getCurrent();
    log.info("Stored " + u2.get());
  }
 catch (  Exception e1) {
    throw new RuntimeException(e1);
  }
  stateTracker.setMiniBatchSize(conf.getSplit());
}
