{
  if (!dataSetIterator.hasNext()) {
    ScoreReport report=new ScoreReport();
    report.setS(0.0);
    report.setM(Runtime.getRuntime().maxMemory());
    return Collections.singletonList(new Tuple3<Gradient,ComputationGraphUpdater,ScoreReport>(new DefaultGradient(),null,report));
  }
  List<MultiDataSet> collect=new ArrayList<>();
  while (dataSetIterator.hasNext()) {
    collect.add(dataSetIterator.next());
  }
  MultiDataSet data=org.nd4j.linalg.dataset.MultiDataSet.merge(collect);
  ComputationGraph network=new ComputationGraph(ComputationGraphConfiguration.fromJson(json));
  network.init();
  INDArray val=params.value().dup();
  ComputationGraphUpdater upd=updater.getValue().clone();
  if (val.length() != network.numParams())   throw new IllegalStateException("Network did not have same number of parameters as the broadcasted set parameters");
  network.setParams(val);
  network.setUpdater(upd);
  network.fit(data);
  ScoreReport report=new ScoreReport();
  report.setS(network.score());
  report.setM(Runtime.getRuntime().maxMemory());
  return Collections.singletonList(new Tuple3<>(network.gradient(),network.getUpdater(),report));
}
