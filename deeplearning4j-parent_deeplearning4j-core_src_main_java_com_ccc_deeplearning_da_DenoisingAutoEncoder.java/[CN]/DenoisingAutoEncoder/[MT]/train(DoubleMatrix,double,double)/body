{
  this.input=x;
  DoubleMatrix tildeX=getCorruptedInput(x,corruptionLevel);
  DoubleMatrix y=getHiddenValues(tildeX);
  DoubleMatrix z=getReconstructedInput(y);
  DoubleMatrix L_h2=x.sub(z);
  DoubleMatrix L_h1=L_h2.mmul(W).mul(y).mul(oneMinus(y));
  DoubleMatrix L_vbias=L_h2;
  DoubleMatrix L_hbias=L_h1;
  DoubleMatrix L_W=tildeX.transpose().mmul(L_h1).add(L_h2.transpose().mmul(y)).mul(lr);
  this.W=W.add(L_W).mul(momentum);
  DoubleMatrix L_hbias_mean=L_hbias.columnMeans().mul(lr);
  DoubleMatrix L_vbias_mean=L_vbias.columnMeans().mul(lr);
  this.hBias=hBias.add(L_hbias_mean);
  this.vBias=vBias.add(L_vbias_mean);
}
