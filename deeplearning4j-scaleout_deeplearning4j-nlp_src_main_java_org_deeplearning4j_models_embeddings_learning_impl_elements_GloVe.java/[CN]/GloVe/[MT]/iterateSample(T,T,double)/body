{
  INDArray w1Vector=syn0.slice(element1.getIndex());
  INDArray w2Vector=syn0.slice(element2.getIndex());
  if (element1.getIndex() < 0 || element1.getIndex() >= syn0.rows())   throw new IllegalArgumentException("Illegal index for word " + element1.getLabel());
  if (element2.getIndex() < 0 || element2.getIndex() >= syn0.rows())   throw new IllegalArgumentException("Illegal index for word " + element2.getLabel());
  double prediction=Nd4j.getBlasWrapper().dot(w1Vector,w2Vector);
  prediction+=bias.getDouble(element1.getIndex()) + bias.getDouble(element2.getIndex());
  double weight=Math.pow(Math.min(1.0,(score / maxCount)),xMax);
  double fDiff=score > xMax ? prediction : weight * (prediction - Math.log(score));
  if (Double.isNaN(fDiff))   fDiff=Nd4j.EPS_THRESHOLD;
  double gradient=fDiff;
  update(element1,w1Vector,w2Vector,gradient);
  update(element2,w2Vector,w1Vector,gradient);
  return fDiff;
}
