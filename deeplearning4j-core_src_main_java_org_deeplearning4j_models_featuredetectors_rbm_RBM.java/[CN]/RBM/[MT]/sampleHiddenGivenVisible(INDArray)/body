{
  if (conf.getHiddenUnit() == HiddenUnit.RECTIFIED) {
    INDArray h1Mean=propUp(v);
    INDArray sigH1Mean=sigmoid(h1Mean);
    INDArray sqrtSigH1Mean=sqrt(sigH1Mean);
    INDArray sample=normal(conf.getRng(),h1Mean,1);
    sample.muli(sqrtSigH1Mean);
    INDArray h1Sample=h1Mean.add(sample);
    h1Sample=Transforms.max(h1Sample,1.0);
    applyDropOutIfNecessary(h1Sample);
    return new Pair<>(h1Mean,h1Sample);
  }
 else   if (conf.getHiddenUnit() == HiddenUnit.GAUSSIAN) {
    INDArray h1Mean=propUp(v);
    INDArray h1Sample=h1Mean.add(Nd4j.randn(h1Mean.rows(),h1Mean.columns(),conf.getRng()));
    applyDropOutIfNecessary(h1Sample);
    return new Pair<>(h1Mean,h1Sample);
  }
 else   if (conf.getHiddenUnit() == HiddenUnit.SOFTMAX) {
    INDArray h1Mean=propUp(v);
    INDArray h1Sample=Nd4j.getExecutioner().execAndReturn(Nd4j.getOpFactory().createTransform("softmax",h1Mean),0);
    applyDropOutIfNecessary(h1Sample);
    return new Pair<>(h1Mean,h1Sample);
  }
 else   if (conf.getHiddenUnit() == HiddenUnit.BINARY) {
    INDArray h1Mean=propUp(v);
    INDArray h1Sample=binomial(h1Mean,1,conf.getRng());
    applyDropOutIfNecessary(h1Sample);
    return new Pair<>(h1Mean,h1Sample);
  }
  throw new IllegalStateException("Hidden unit type must either be rectified linear or binary");
}
