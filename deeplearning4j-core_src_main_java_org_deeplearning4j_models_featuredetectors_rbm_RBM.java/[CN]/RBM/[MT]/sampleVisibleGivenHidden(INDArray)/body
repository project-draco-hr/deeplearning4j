{
  INDArray v1Mean=propDown(h);
  if (conf.getVisibleUnit() == VisibleUnit.GAUSSIAN) {
    INDArray v1Sample=v1Mean.add(Nd4j.randn(v1Mean.rows(),v1Mean.columns(),conf.getRng()));
    return new Pair<>(v1Mean,v1Sample);
  }
 else   if (conf.getVisibleUnit() == VisibleUnit.LINEAR) {
    INDArray v1Sample=normal(conf.getRng(),v1Mean,1);
    return new Pair<>(v1Mean,v1Sample);
  }
 else   if (conf.getVisibleUnit() == VisibleUnit.SOFTMAX) {
    INDArray v1Sample=Activations.softMaxRows().apply(v1Mean);
    return new Pair<>(v1Mean,v1Sample);
  }
 else   if (conf.getVisibleUnit() == VisibleUnit.BINARY) {
    INDArray v1Sample=binomial(v1Mean,1,conf.getRng());
    return new Pair<>(v1Mean,v1Sample);
  }
  throw new IllegalStateException("Visible type must either be binary,gaussian, softmax, or linear");
}
