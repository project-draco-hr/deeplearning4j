{
  MnistDataSetIterator iter=new MnistDataSetIterator(600,6000);
  RandomGenerator rng=new MersenneTwister(123);
  DataSet first=iter.next();
  int numIns=first.getFirst().columns;
  int numLabels=first.getSecond().columns;
  int[] layerSizes={numIns,numIns,numIns};
  double lr=0.1;
  StackedDenoisingAutoEncoder sda=new StackedDenoisingAutoEncoder.Builder().numberOfInputs(numIns).numberOfOutPuts(numLabels).withRng(rng).hiddenLayerSizes(layerSizes).build();
  DoubleMatrix data1=first.getFirst().dup();
  DoubleMatrix outcomes=first.getSecond().dup();
  do {
    sda.pretrain(data1,lr,0.3,1000);
    sda.finetune(outcomes,lr,100);
    Evaluation eval=new Evaluation();
    log.info("BEGIN EVAL ON " + first.numExamples());
    DoubleMatrix predicted=sda.predict(data1);
    log.info("Predicted\n " + predicted.toString().replaceAll(";","\n"));
    eval.eval(first.getSecond(),predicted);
    log.info(eval.stats());
    log.info("Loss is " + sda.negativeLogLikelihood());
    if (iter.hasNext())     first=iter.next();
  }
 while (iter.hasNext());
}
