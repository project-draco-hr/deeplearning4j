{
  if (layerWiseConfigurations.getBackpropType() == BackpropType.TruncatedBPTT) {
    update(TaskUtils.buildTask(data));
    doTruncatedBPTT(data.getFeatureMatrix(),data.getLabels(),data.getFeaturesMaskArray(),data.getLabelsMaskArray());
  }
 else {
    update(TaskUtils.buildTask(data));
    boolean hasMaskArrays=data.hasMaskArrays();
    if (hasMaskArrays)     setLayerMaskArrays(data.getFeaturesMaskArray(),data.getLabelsMaskArray());
    fit(data.getFeatureMatrix(),data.getLabels());
    if (hasMaskArrays)     clearLayerMaskArrays();
  }
}
