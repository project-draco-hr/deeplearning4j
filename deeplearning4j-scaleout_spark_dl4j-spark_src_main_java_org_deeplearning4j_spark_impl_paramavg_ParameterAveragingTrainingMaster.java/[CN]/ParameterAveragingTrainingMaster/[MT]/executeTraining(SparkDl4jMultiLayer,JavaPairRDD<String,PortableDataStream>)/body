{
  if (numWorkers == null)   numWorkers=network.getSparkContext().defaultParallelism();
  long totalDataSetObjectCount=trainingData.count();
  int dataSetObjectsPerSplit=getNumDataSetObjectsPerSplit();
  if (collectTrainingStats)   stats.logSplitStart();
  JavaPairRDD<String,PortableDataStream>[] splits=SparkUtils.balancedRandomSplit((int)totalDataSetObjectCount,dataSetObjectsPerSplit,trainingData);
  if (collectTrainingStats)   stats.logSplitEnd();
  int splitNum=1;
  for (  JavaPairRDD<String,PortableDataStream> split : splits) {
    JavaRDD<PortableDataStream> temp=split.values();
    if (collectTrainingStats)     stats.logRepartitionStart();
    temp=SparkUtils.repartitionBalanceIfRequired(temp,repartition,numObjectsEachWorker(),numWorkers);
    if (collectTrainingStats && repartition != Repartition.Never)     stats.logRepartitionEnd();
    JavaRDD<DataSet> splitData=temp.map(new LoadSerializedDataSetFunction());
    doIteration(network,splitData,splitNum++,splits.length);
  }
  if (collectTrainingStats)   stats.logFitEnd((int)totalDataSetObjectCount);
}
