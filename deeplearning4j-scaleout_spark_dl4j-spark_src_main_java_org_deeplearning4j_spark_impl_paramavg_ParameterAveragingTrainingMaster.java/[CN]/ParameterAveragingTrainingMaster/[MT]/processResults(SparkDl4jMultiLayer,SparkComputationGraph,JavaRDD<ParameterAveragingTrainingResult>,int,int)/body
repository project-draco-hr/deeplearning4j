{
  if (collectTrainingStats)   stats.logAggregateStartTime();
  ParameterAveragingAggregationTuple tuple=results.aggregate(null,new ParameterAveragingElementAddFunction(),new ParameterAveragingElementCombineFunction());
  INDArray params=tuple.getParametersSum();
  int aggCount=tuple.getAggregationsCount();
  UpdaterAggregator updaterAg=tuple.getUpdaterAggregator();
  SparkTrainingStats aggregatedStats=tuple.getSparkTrainingStats();
  if (collectTrainingStats)   stats.logAggregationEndTime();
  if (collectTrainingStats)   stats.logProcessParamsUpdaterStart();
  params.divi(aggCount);
  if (network != null) {
    MultiLayerNetwork net=network.getNetwork();
    Updater updater=updaterAg.getUpdater();
    net.setParameters(params);
    net.setUpdater(updater);
  }
 else {
    ComputationGraph g=graph.getNetwork();
    ComputationGraphUpdater updater=null;
    g.setParams(params);
    g.setUpdater(updater);
    throw new RuntimeException("NOT YET IMPLEMENTED");
  }
  if (collectTrainingStats) {
    stats.logProcessParamsUpdaterEnd();
    stats.addWorkerStats(aggregatedStats);
  }
  log.info("Completed training of split {} of {}",splitNum,totalSplits);
  network.setScore(tuple.getScoreSum() / tuple.getAggregationsCount());
}
