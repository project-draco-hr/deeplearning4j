{
  File rootDir=new ClassPathResource("rootdir").getFile();
  LabelAwareSentenceIterator iter=new LabelAwareFileSentenceIterator(rootDir);
  List<String> labels=Arrays.asList("label1","label2");
  TokenizerFactory tokenizerFactory=new DefaultTokenizerFactory();
  BagOfWordsVectorizer vectorizer=new BagOfWordsVectorizer.Builder().setMinWordFrequency(1).setStopWords(new ArrayList<String>()).setTokenizerFactory(tokenizerFactory).setIterator(iter).build();
  vectorizer.fit();
  VocabWord word=vectorizer.getVocabCache().wordFor("file.");
  assumeNotNull(word);
  assertEquals(word,vectorizer.getVocabCache().tokenFor("file."));
  assertEquals(2,vectorizer.getVocabCache().totalNumberOfDocs());
  assertEquals(2,word.getSequencesCount());
  assertEquals(2,word.getElementFrequency(),0.1);
  VocabWord word1=vectorizer.getVocabCache().wordFor("1");
  assertEquals(1,word1.getSequencesCount());
  assertEquals(1,word1.getElementFrequency(),0.1);
  log.info("Labels used: " + vectorizer.getLabelsSource().getLabels());
  assertEquals(2,vectorizer.getLabelsSource().getNumberOfLabelsUsed());
  INDArray array=vectorizer.transform("This is 2 file.");
  log.info("Transformed array: " + array);
  assertEquals(5,array.columns());
  assertEquals(2,array.getDouble(0),0.1);
  assertEquals(2,array.getDouble(1),0.1);
  assertEquals(2,array.getDouble(2),0.1);
  assertEquals(0,array.getDouble(3),0.1);
  assertEquals(1,array.getDouble(4),0.1);
  DataSet dataSet=vectorizer.vectorize("This is 2 file.","label2");
  assertEquals(array,dataSet.getFeatureMatrix());
  INDArray labelz=dataSet.getLabels();
  log.info("Labels array: " + labelz);
  assertEquals(1.0,dataSet.getLabels().getDouble(0),0.1);
  assertEquals(0.0,dataSet.getLabels().getDouble(1),0.1);
  dataSet=vectorizer.vectorize("This is 1 file.","label1");
  assertEquals(2,dataSet.getFeatureMatrix().getDouble(0),0.1);
  assertEquals(2,dataSet.getFeatureMatrix().getDouble(1),0.1);
  assertEquals(2,dataSet.getFeatureMatrix().getDouble(2),0.1);
  assertEquals(1,dataSet.getFeatureMatrix().getDouble(3),0.1);
  assertEquals(0,dataSet.getFeatureMatrix().getDouble(4),0.1);
  assertEquals(0.0,dataSet.getLabels().getDouble(0),0.1);
  assertEquals(1.0,dataSet.getLabels().getDouble(1),0.1);
  File tempFile=File.createTempFile("fdsf","fdfsdf");
  tempFile.deleteOnExit();
  SerializationUtils.saveObject(vectorizer,tempFile);
  BagOfWordsVectorizer vectorizer2=SerializationUtils.readObject(tempFile);
  vectorizer2.setTokenizerFactory(tokenizerFactory);
  dataSet=vectorizer2.vectorize("This is 2 file.","label2");
  assertEquals(array,dataSet.getFeatureMatrix());
}
