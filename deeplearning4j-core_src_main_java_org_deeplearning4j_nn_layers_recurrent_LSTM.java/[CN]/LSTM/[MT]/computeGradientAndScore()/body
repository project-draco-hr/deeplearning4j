{
  INDArray forward=forward(xi,xs);
  INDArray probas=Nd4j.getExecutioner().execAndReturn(Nd4j.getOpFactory().createTransform("softmax",forward).derivative(),1);
  gradient=backprop(probas);
  if (conf.getLossFunction() == LossFunctions.LossFunction.CUSTOM) {
    LossFunction create=Nd4j.getOpFactory().createLossFunction(conf.getCustomLossFunction(),input,forward);
    create.exec();
    score=create.currentResult().doubleValue();
  }
 else {
    score=LossCalculation.builder().l1(calcL1()).l2(calcL2()).labels(xs).z(probas).lossFunction(conf.getLossFunction()).miniBatch(conf.isMiniBatch()).miniBatchSize(getInputMiniBatchSize()).useRegularization(conf.isUseRegularization()).build().score();
  }
}
