{
  if (kernel.isScalar() && input.isScalar())   return kernel.mul(input);
  DoubleMatrix shape=MatrixUtil.toMatrix(input.shape()).add(MatrixUtil.toMatrix(kernel.shape())).subi(1);
  int[] intShape=MatrixUtil.toInts(shape);
  int[] axes=ArrayUtil.range(0,intShape.length);
  ComplexNDArray ret=FFT.rawifftn(FFT.rawfftn(new ComplexNDArray(input),intShape,axes).muli(FFT.rawfftn(new ComplexNDArray(kernel),intShape,axes)),intShape,axes);
switch (type) {
case FULL:
    return ret.getReal();
case SAME:
  return ComplexNDArrayUtil.center(ret,input.shape()).getReal();
case VALID:
return ComplexNDArrayUtil.center(ret,MatrixUtil.toInts(MatrixUtil.toMatrix(input.shape()).sub(MatrixUtil.toMatrix(kernel.shape())).addi(1))).getReal();
}
return ret.getReal();
}
