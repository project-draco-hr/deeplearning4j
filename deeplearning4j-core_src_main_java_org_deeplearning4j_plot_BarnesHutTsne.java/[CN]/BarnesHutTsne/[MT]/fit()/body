{
  boolean exact=theta == 0.0;
  if (exact)   y=super.calculate(x,numDimensions,perplexity);
 else {
    INDArray p=computeGaussianPerplexity(x,perplexity);
    for (int i=0; i < maxIter; i++) {
      step(p,i);
      if (i == switchMomentumIteration)       momentum=finalMomentum;
      if (i == stopLyingIteration)       p.divi(4);
      if (iterationListener != null)       iterationListener.iterationDone(i);
    }
  }
}
