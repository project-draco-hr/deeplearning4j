{
  boolean exact=theta == 0.0;
  if (exact)   y=super.calculate(x,numDimensions,perplexity);
 else {
    if (y == null)     y=randn(x.rows(),numDimensions,new MersenneTwister(123)).muli(1e-3f);
    computeGaussianPerplexity(x,perplexity);
    vals=symmetrized(rows,cols,vals).divi(vals.sum(Integer.MAX_VALUE));
    vals.muli(12);
    for (int i=0; i < maxIter; i++) {
      step(vals,i);
      if (i == switchMomentumIteration)       momentum=finalMomentum;
      if (i == stopLyingIteration)       vals.divi(12);
      if (iterationListener != null)       iterationListener.iterationDone(i);
      log.info("Error at iteration " + i + " is "+ score());
    }
  }
}
