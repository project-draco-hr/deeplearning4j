{
  Config conf=ConfigFactory.parseString("akka.cluster.roles=[master,worker]").withFallback(ConfigFactory.load());
  ActorSystem system=ActorSystem.create(systemName,conf);
  RoundRobinPool pool=new RoundRobinPool(Runtime.getRuntime().availableProcessors());
  ActorRef batchActor=system.actorOf(pool.props(Props.create(BatchActor.class,iter)));
  Props masterProps=startingNetwork != null ? MasterActor.propsFor(c,batchActor,startingNetwork) : MasterActor.propsFor(c,batchActor);
  log.info("Started batch actor");
  Address realJoinAddress=(joinAddress == null) ? Cluster.get(system).selfAddress() : joinAddress;
  Cluster.get(system).join(realJoinAddress);
  masterActor=system.actorOf(ClusterSingletonManager.defaultProps(masterProps,"active",PoisonPill.getInstance(),"master"));
  return realJoinAddress;
}
