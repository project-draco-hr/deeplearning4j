{
  if (cache.size() >= batch())   return fromCache();
  File f=files.next();
  try {
    LineIterator lines=FileUtils.lineIterator(f);
    while (lines.hasNext()) {
      List<Window> windows=Windows.windows(lines.nextLine());
      DoubleMatrix outcomes=null;
      DoubleMatrix input=null;
      if (windows.size() < batch()) {
        input=new DoubleMatrix(windows.size(),vec.getSyn1().columns * vec.getWindow());
        outcomes=new DoubleMatrix(batch(),labels.size());
        for (int i=0; i < windows.size(); i++) {
          input.putRow(i,new DoubleMatrix(WindowConverter.asExample(windows.get(i),vec)));
          outcomes.put(i,labels.indexOf(windows.get(i).getLabel()),1.0);
        }
        return new DataSet(input,outcomes);
      }
 else {
        input=new DoubleMatrix(batch(),vec.getSyn1().columns * vec.getWindow());
        outcomes=new DoubleMatrix(batch(),labels.size());
        for (int i=0; i < batch(); i++) {
          input.putRow(i,new DoubleMatrix(WindowConverter.asExample(windows.get(i),vec)));
          outcomes.put(i,labels.indexOf(windows.get(i).getLabel()),1.0);
        }
        if (windows.size() > batch()) {
          List<Window> leftOvers=windows.subList(batch,windows.size());
          cache.addAll(leftOvers);
        }
        return new DataSet(input,outcomes);
      }
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  return null;
}
