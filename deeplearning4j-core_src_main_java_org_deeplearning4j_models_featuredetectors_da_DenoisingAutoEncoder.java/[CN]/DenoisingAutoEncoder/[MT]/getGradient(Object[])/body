{
  double corruptionLevel=conf.getCorruptionLevel();
  double lr=conf.getLr();
  int iteration=conf.getNumIterations();
  if (wAdaGrad != null)   this.wAdaGrad.setMasterStepSize(lr);
  if (hBiasAdaGrad != null)   this.hBiasAdaGrad.setMasterStepSize(lr);
  if (vBiasAdaGrad != null)   vBiasAdaGrad.setMasterStepSize(lr);
  INDArray corruptedX=getCorruptedInput(input,corruptionLevel);
  INDArray y=getHiddenValues(corruptedX);
  INDArray z=getReconstructedInput(y);
  INDArray visibleLoss=input.sub(z);
  INDArray hiddenLoss=conf.getSparsity() == 0 ? visibleLoss.mmul(W).mul(y).mul(y.rsub(1)) : visibleLoss.mmul(W).mul(y).mul(y.add(-conf.getSparsity()));
  INDArray wGradient=corruptedX.transpose().mmul(hiddenLoss).add(visibleLoss.transpose().mmul(y));
  INDArray hBiasGradient=hiddenLoss.mean(0);
  INDArray vBiasGradient=visibleLoss.mean(0);
  NeuralNetworkGradient gradient=new NeuralNetworkGradient(wGradient,vBiasGradient,hBiasGradient);
  updateGradientAccordingToParams(gradient,iteration,lr);
  return gradient;
}
