{
  Address contactAddress=AddressFromURIString.parse(conf.get(MASTER_URL));
  system.actorOf(Props.create(ClusterListener.class));
  log.info("Attempting to join node " + contactAddress);
  log.info("Starting workers");
  Set<ActorSelection> initialContacts=new HashSet<>();
  initialContacts.add(system.actorSelection(contactAddress + "/user/"));
  RoundRobinPool pool=new RoundRobinPool(Runtime.getRuntime().availableProcessors());
  ActorRef clusterClient=system.actorOf(ClusterClient.defaultProps(initialContacts),"clusterClient");
  try {
    String host=contactAddress.host().get();
    log.info("Connecting  to host " + host);
    int workers=stateTracker.numWorkers();
    if (workers <= 1)     throw new IllegalStateException("Did not properly connect to cluster");
    log.info("Joining cluster of size " + workers);
    Class<? extends WorkerPerformerFactory> factoryClazz=(Class<? extends WorkerPerformerFactory>)Class.forName(conf.get(WorkerPerformerFactory.WORKER_PERFORMER));
    WorkerPerformerFactory factory=factoryClazz.newInstance();
    WorkerPerformer performer=factory.create(conf);
    Props p=pool.props(WorkerActor.propsFor(conf,stateTracker,performer));
    system.actorOf(p,"worker");
    Cluster cluster=Cluster.get(system);
    cluster.join(contactAddress);
    log.info("Worker joining cluster");
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
