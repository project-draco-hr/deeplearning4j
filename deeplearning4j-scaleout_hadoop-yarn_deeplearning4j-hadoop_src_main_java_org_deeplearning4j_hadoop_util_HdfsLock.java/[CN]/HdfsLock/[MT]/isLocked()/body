{
  String lockPath=new ZookeeperPathBuilder().setHost(host).setPort(port).addPath("hdfslock2").build().replaceAll("//","/");
  Stat stat=zk.exists(lockPath,true);
  boolean ret=stat != null;
  if (ret) {
    try {
      List<Path> paths=getPaths();
      Configuration conf=new Configuration();
      HdfsUtils.setHostForConf(conf);
      FileSystem system=FileSystem.get(conf);
      for (      Path path : paths) {
        if (!system.exists(path)) {
          log.info("Paths found to be inconsistent. Auto clearing lock");
          ret=false;
          zk.delete(lockPath,-1);
          break;
        }
      }
    }
 catch (    Exception e) {
      log.error("Error accessing data, returning false",e);
      return false;
    }
  }
  return ret;
}
