{
  if (input.rank() != 3)   throw new IllegalArgumentException("input must be rank 3");
  INDArray preOutput2d=preOutput2d(input,training);
  if (conf.getLayer().getActivationFunction().equals("softmax")) {
    SoftMax softMax=new SoftMax(preOutput2d);
    softMax.exec(1);
    INDArray out2d=softMax.z();
    return reshape2dTo3d(out2d,input.size(0));
  }
  if (training)   applyDropOutIfNecessary(input(),training);
  INDArray origInput=input;
  this.input=reshape3dTo2d(input);
  INDArray out=super.activate(true);
  this.input=origInput;
  return out;
}
